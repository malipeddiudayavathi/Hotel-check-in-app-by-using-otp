// File: build.gradle (Project)
buildscript {
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:8.1.0'
        classpath 'com.google.gms:google-services:4.4.0' // google services plugin
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
    }
}// File: app/build.gradle
apply plugin: 'com.android.application'
apply plugin: 'com.google.gms.google-services'

android {
    compileSdk 34

    defaultConfig {
        applicationId "com.example.hotelcheckin"
        minSdk 21
        targetSdk 34
        versionCode 1
        versionName "1.0"

        // required for phone auth callbacks on newer gradles
        multiDexEnabled true
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
}

dependencies {
    implementation 'androidx.appcompat:appcompat:1.6.1'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
    implementation 'com.google.android.material:material:1.9.0'
    implementation 'com.google.firebase:firebase-auth:22.1.0'
    implementation 'com.google.firebase:firebase-firestore:24.5.0'
    implementation 'com.google.android.gms:play-services-auth:20.7.0'
    implementation 'com.google.android.gms:play-services-base:18.3.0'
    implementation 'androidx.lifecycle:lifecycle-runtime-ktx:2.6.1'
    implementation 'com.google.code.gson:gson:2.10.1'
    implementation 'androidx.multidex:multidex:2.0.1'
}// File: app/src/main/java/com/example/hotelcheckin/LoginActivity.java
package com.example.hotelcheckin;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ProgressBar;
import android.widget.Toast;

import com.google.firebase.FirebaseException;
import com.google.firebase.auth.PhoneAuthOptions;
import com.google.firebase.auth.PhoneAuthProvider;

import java.util.concurrent.TimeUnit;

public class LoginActivity extends AppCompatActivity {

    EditText etPhone;
    Button btnSendOtp;
    ProgressBar progressBar;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);

        etPhone = findViewById(R.id.etPhone);
        btnSendOtp = findViewById(R.id.btnSendOtp);
        progressBar = findViewById(R.id.progressBar);

        btnSendOtp.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String phone = etPhone.getText().toString().trim();
                if (TextUtils.isEmpty(phone)) {
                    etPhone.setError("Enter phone number");
                    return;
                }

                // Normalize phone — the user must include country code. For demo assume +91 for India if not provided.
                if (!phone.startsWith("+")) {
                    phone = "+91" + phone;
                }

                progressBar.setVisibility(View.VISIBLE);
                btnSendOtp.setEnabled(false);

                PhoneAuthOptions options =
                        PhoneAuthOptions.newBuilder(com.google.firebase.auth.FirebaseAuth.getInstance())
                                .setPhoneNumber(phone)
                                .setTimeout(60L, TimeUnit.SECONDS)
                                .setActivity(LoginActivity.this)
                                .setCallbacks(new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
                                    @Override
                                    public void onVerificationCompleted(@NonNull com.google.firebase.auth.PhoneAuthCredential credential) {
                                        // Auto-retrieval or instant verification — sign in directly if desired.
                                        progressBar.setVisibility(View.GONE);
                                        btnSendOtp.setEnabled(true);
                                        // Move to main activity by passing credential or simply open OTP screen
                                        Intent intent = new Intent(LoginActivity.this, MainActivity.class);
                                        intent.putExtra("PHONE", phone);
                                        startActivity(intent);
                                        finish();
                                    }

                                    @Override
                                    public void onVerificationFailed(@NonNull FirebaseException e) {
                                        progressBar.setVisibility(View.GONE);
                                        btnSendOtp.setEnabled(true);
                                        Toast.makeText(LoginActivity.this, "Verification failed: " + e.getMessage(), Toast.LENGTH_LONG).show();
                                    }

                                    @Override
                                    public void onCodeSent(@NonNull String verificationId,
                                                           @NonNull PhoneAuthProvider.ForceResendingToken token) {
                                        progressBar.setVisibility(View.GONE);
                                        btnSendOtp.setEnabled(true);
                                        // open OTP screen
                                        Intent intent = new Intent(LoginActivity.this, OtpActivity.class);
                                        intent.putExtra("verificationId", verificationId);
                                        intent.putExtra("phone", phone);
                                        startActivity(intent);
                                    }
                                })
                                .build();

                PhoneAuthProvider.verifyPhoneNumber(options);
            }
        });
    }
}// File: app/src/main/java/com/example/hotelcheckin/OtpActivity.java
package com.example.hotelcheckin;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ProgressBar;
import android.widget.Toast;

import com.google.firebase.auth.AuthResult;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.PhoneAuthCredential;
import com.google.firebase.auth.PhoneAuthProvider;

public class OtpActivity extends AppCompatActivity {

    EditText etOtp;
    Button btnVerify;
    ProgressBar progressBar;
    String verificationId;
    FirebaseAuth mAuth;
    String phone;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_otp);

        etOtp = findViewById(R.id.etOtp);
        btnVerify = findViewById(R.id.btnVerify);
        progressBar = findViewById(R.id.progressBarOtp);
        mAuth = FirebaseAuth.getInstance();

        verificationId = getIntent().getStringExtra("verificationId");
        phone = getIntent().getStringExtra("phone");

        btnVerify.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String code = etOtp.getText().toString().trim();
                if (TextUtils.isEmpty(code)) {
                    etOtp.setError("Enter OTP");
                    return;
                }
                progressBar.setVisibility(View.VISIBLE);
                btnVerify.setEnabled(false);

                PhoneAuthCredential credential = PhoneAuthProvider.getCredential(verificationId, code);
                mAuth.signInWithCredential(credential)
                        .addOnCompleteListener(OtpActivity.this, task -> {
                            progressBar.setVisibility(View.GONE);
                            btnVerify.setEnabled(true);
                            if (task.isSuccessful()) {
                                // Signed in
                                Intent i = new Intent(OtpActivity.this, MainActivity.class);
                                i.putExtra("PHONE", phone);
                                startActivity(i);
                                finish();
                            } else {
                                Toast.makeText(OtpActivity.this, "Verification failed: " + task.getException().getMessage(), Toast.LENGTH_LONG).show();
                            }
                        });
            }
        });
    }
}// File: app/src/main/java/com/example/hotelcheckin/MainActivity.java
package com.example.hotelcheckin;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ProgressBar;
import android.widget.Toast;

import com.google.firebase.firestore.FirebaseFirestore;

import java.util.HashMap;
import java.util.Map;

public class MainActivity extends AppCompatActivity {

    EditText etName, etRoomNo, etCheckinDate, etNights;
    Button btnCheckin;
    ProgressBar progressBar;
    FirebaseFirestore firestore;
    String phone;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        etName = findViewById(R.id.etName);
        etRoomNo = findViewById(R.id.etRoomNo);
        etCheckinDate = findViewById(R.id.etCheckinDate);
        etNights = findViewById(R.id.etNights);
        btnCheckin = findViewById(R.id.btnCheckin);
        progressBar = findViewById(R.id.progressBarMain);

        firestore = FirebaseFirestore.getInstance();
        phone = getIntent().getStringExtra("PHONE");

        btnCheckin.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String name = etName.getText().toString().trim();
                String room = etRoomNo.getText().toString().trim();
                String date = etCheckinDate.getText().toString().trim();
                String nights = etNights.getText().toString().trim();

                if (TextUtils.isEmpty(name)) { etName.setError("Required"); return; }
                if (TextUtils.isEmpty(room)) { etRoomNo.setError("Required"); return; }
                if (TextUtils.isEmpty(date)) { etCheckinDate.setError("Required"); return; }
                if (TextUtils.isEmpty(nights)) { etNights.setError("Required"); return; }

                progressBar.setVisibility(View.VISIBLE);
                btnCheckin.setEnabled(false);

                Map<String, Object> data = new HashMap<>();
                data.put("name", name);
                data.put("phone", phone);
                data.put("roomNo", room);
                data.put("checkinDate", date);
                data.put("nights", nights);
                data.put("timestamp", System.currentTimeMillis());

                // Save under collection "checkins"
                firestore.collection("checkins")
                        .add(data)
                        .addOnSuccessListener(documentReference -> {
                            progressBar.setVisibility(View.GONE);
                            btnCheckin.setEnabled(true);
                            // Open confirmation screen with document id
                            Intent i = new Intent(MainActivity.this, ConfirmationActivity.class);
                            i.putExtra("docId", documentReference.getId());
                            i.putExtra("name", name);
                            i.putExtra("roomNo", room);
                            startActivity(i);
                        })
                        .addOnFailureListener(e -> {
                            progressBar.setVisibility(View.GONE);
                            btnCheckin.setEnabled(true);
                            Toast.makeText(MainActivity.this, "Error: " + e.getMessage(), Toast.LENGTH_LONG).show();
                        });
            }
        });
    }
}// File: app/src/main/java/com/example/hotelcheckin/ConfirmationActivity.java
package com.example.hotelcheckin;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.widget.TextView;

public class ConfirmationActivity extends AppCompatActivity {

    TextView tvMessage, tvDocId;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_confirmation);

        tvMessage = findViewById(R.id.tvMessage);
        tvDocId = findViewById(R.id.tvDocId);

        String name = getIntent().getStringExtra("name");
        String roomNo = getIntent().getStringExtra("roomNo");
        String docId = getIntent().getStringExtra("docId");

        tvMessage.setText("Thank you, " + name + ".\nRoom: " + roomNo + "\nYou are checked in.");
        tvDocId.setText("Record ID: " + docId);
    }
}<!-- File: app/src/main/res/layout/activity_login.xml -->
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:padding="24dp"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <EditText
        android:id="@+id/etPhone"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:hint="Phone number (e.g. 9876543210)"
        android:inputType="phone"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"/>

    <Button
        android:id="@+id/btnSendOtp"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:text="Send OTP"
        app:layout_constraintTop_toBottomOf="@id/etPhone"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        android:layout_marginTop="16dp"/>

    <ProgressBar
        android:id="@+id/progressBar"
        android:layout_width="48dp"
        android:layout_height="48dp"
        android:visibility="gone"
        app:layout_constraintTop_toBottomOf="@id/btnSendOtp"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        android:layout_marginTop="16dp"/>
</androidx.constraintlayout.widget.ConstraintLayout><!-- File: app/src/main/res/layout/activity_confirmation.xml -->
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:padding="24dp"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <TextView
        android:id="@+id/tvMessage"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:text="Checked in!"
        android:textSize="18sp"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"/>

    <TextView
        android:id="@+id/tvDocId"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:text="Record ID"
        android:layout_marginTop="16dp"
        app:layout_constraintTop_toBottomOf="@id/tvMessage"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"/>

</androidx.constraintlayout.widget.ConstraintLayout>// Firestore rules snippet (in Firebase Console)
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /checkins/{docId} {
      allow read, write: if request.auth != null;
    }
  }
}
